<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentic CPEE Graph Renderer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 2rem 0;
        }

        .container {
            max-width: 1400px;
        }

        .card {
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: none;
            border-radius: 12px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        #graph-container {
            min-height: 500px;
            background: white;
            border-radius: 8px;
            overflow: auto;
        }

        .xml-input {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }

        .graph-controls button {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CPEE Graph Renderer</h1>
            <p>Using CPEE WfAdaptor system directly</p>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>CPEE XML Input</h5>
                    </div>
                    <div class="card-body">
                        <textarea id="xml-input" class="form-control xml-input" rows="20" placeholder="Paste your CPEE XML here..."><?xml version="1.0"?>
<description xmlns="http://cpee.org/ns/properties/2.0">
  <call id="a1" endpoint="service1">
    <parameters>
      <label>Initialize Process</label>
      <arguments>
        <data>Initial data</data>
      </arguments>
    </parameters>
  </call>
  <call id="a2" endpoint="service2">
    <parameters>
      <label>Process Data</label>
      <arguments>
        <input>processed data</input>
      </arguments>
    </parameters>
  </call>
  <choose>
    <alternative condition="result == 'success'">
      <call id="a3" endpoint="success_handler">
        <parameters>
          <label>Handle Success</label>
        </parameters>
      </call>
    </alternative>
    <otherwise>
      <call id="a4" endpoint="error_handler">
        <parameters>
          <label>Handle Error</label>
        </parameters>
      </call>
    </otherwise>
  </choose>
  <loop mode="post_test" condition="data.count > 0">
    <call id="a5" endpoint="process_item">
      <parameters>
        <label>Process Item</label>
        <arguments>
          <item>current_item</item>
        </arguments>
      </parameters>
    </call>
  </loop>
  <parallel>
    <parallel_branch>
      <call id="a6" endpoint="notification_service">
        <parameters>
          <label>Send Notifications</label>
        </parameters>
      </call>
    </parallel_branch>
    <parallel_branch>
      <call id="a7" endpoint="logging_service">
        <parameters>
          <label>Log Activity</label>
        </parameters>
      </call>
    </parallel_branch>
  </parallel>
  <call id="a8" endpoint="finalize">
    <parameters>
      <label>Finalize Process</label>
    </parameters>
  </call>
</description></textarea>
                        
                        <div class="mt-3">
                            <button id="render-btn" class="btn btn-primary">
                                Render with CPEE WfAdaptor
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>CPEE Graph Visualization</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="status-message" class="alert" style="display: none;"></div>
                        <div id="graph-container"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { CPEEWfAdaptorRenderer } from './src/components/CPEEWfAdaptorRenderer.js';

        // Initialize the authentic CPEE renderer
        const renderer = new CPEEWfAdaptorRenderer();
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await renderer.initialize('graph-container', 'status-message', 'xml-input');
                console.log('üèõÔ∏è Authentic CPEE renderer ready');
                
                // Auto-render the example after a short delay
                setTimeout(() => {
                    document.getElementById('render-btn').click();
                }, 1000);
                
            } catch (error) {
                console.error('Failed to initialize renderer:', error);
                document.getElementById('status-message').innerHTML = 
                    '<div class="alert alert-danger">Failed to initialize CPEE renderer: ' + error.message + '</div>';
                document.getElementById('status-message').style.display = 'block';
            }
        });

        // Event handlers
        document.getElementById('render-btn').addEventListener('click', async () => {
            const xmlInput = document.getElementById('xml-input');
            if (xmlInput.value.trim()) {
                await renderer.renderGraph(xmlInput.value);
            } else {
                renderer.showStatus('‚ùå Please enter CPEE XML', 'error');
            }
        });

    </script>
</body>
</html>
