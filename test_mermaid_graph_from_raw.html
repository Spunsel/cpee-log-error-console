<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Graph Renderer Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #333;
            min-height: 100vh;
            padding: 2rem 0;
        }

        .container {
            max-width: 1400px;
        }

        .card {
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: none;
            border-radius: 12px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        #graph-container {
            min-height: 400px;
            background: white;
            border-radius: 8px;
            overflow: auto;
        }

        .mermaid-input {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border: none;
        }

        .example-buttons {
            margin-top: 15px;
        }

        .example-buttons button {
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .diagram-type-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mermaid Graph Renderer</h1>
            <p>Convert raw Mermaid syntax to beautiful SVG graphs</p>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Mermaid Code Input</h5>
                        <div class="diagram-type-info">
                            <strong>Supported types:</strong> flowchart, graph, sequenceDiagram, classDiagram, 
                            stateDiagram, erDiagram, gantt, pie, journey, gitgraph, mindmap, timeline
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea id="mermaid-input" class="form-control mermaid-input" rows="18" placeholder="Paste your Mermaid code here...">graph TD
    A[Start Process] --> B{Decision Point}
    B -->|Yes| C[Process A]
    B -->|No| D[Process B]
    C --> E[Merge Results]
    D --> E
    E --> F{Quality Check}
    F -->|Pass| G[Success]
    F -->|Fail| H[Error Handling]
    H --> I[Retry Process]
    I --> B
    G --> J[End Process]
    
    style A fill:#e1f5fe
    style J fill:#c8e6c9
    style H fill:#ffcdd2</textarea>
                        
                        <div class="mt-3">
                            <button id="render-btn" class="btn btn-primary">
                                üé® Render Mermaid Graph
                            </button>
                            <button id="clear-btn" class="btn btn-outline-secondary ms-2">
                                üóëÔ∏è Clear
                            </button>
                        </div>

                        <div class="example-buttons">
                            <strong>Quick Examples:</strong><br>
                            <button class="btn btn-sm btn-outline-primary" data-example="flowchart">Flowchart</button>
                            <button class="btn btn-sm btn-outline-primary" data-example="sequence">Sequence</button>
                            <button class="btn btn-sm btn-outline-primary" data-example="class">Class</button>
                            <button class="btn btn-sm btn-outline-primary" data-example="state">State</button>
                            <button class="btn btn-sm btn-outline-primary" data-example="gantt">Gantt</button>
                            <button class="btn btn-sm btn-outline-primary" data-example="pie">Pie Chart</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Mermaid Graph Visualization</h5>
                    </div>
                    <div class="card-body p-0">
                        <div id="status-message" class="alert" style="display: none; margin: 15px;"></div>
                        <div id="graph-container"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { MermaidRenderer } from './src/components/MermaidRenderer.js';

        // Example Mermaid diagrams
        const examples = {
            flowchart: `graph TD
    A[Client Request] --> B{Authentication}
    B -->|Valid| C[Process Request]
    B -->|Invalid| D[Return Error]
    C --> E{Data Validation}
    E -->|Valid| F[Execute Logic]
    E -->|Invalid| G[Validation Error]
    F --> H[Return Response]
    G --> I[Error Response]
    D --> I
    H --> J[Log Success]
    I --> K[Log Error]
    
    style A fill:#81c784
    style H fill:#4fc3f7
    style I fill:#e57373`,

            sequence: `sequenceDiagram
    participant U as User
    participant A as App
    participant DB as Database
    participant API as External API
    
    U->>A: Login Request
    A->>DB: Validate Credentials
    DB-->>A: User Data
    A->>API: Get User Profile
    API-->>A: Profile Data
    A-->>U: Login Success
    
    Note over U,API: Authentication Flow
    
    U->>A: Make Request
    A->>DB: Query Data
    DB-->>A: Results
    A-->>U: Response`,

            class: `classDiagram
    class User {
        +String name
        +String email
        +Date createdAt
        +login()
        +logout()
        +updateProfile()
    }
    
    class Order {
        +String id
        +Date orderDate
        +Number total
        +processOrder()
        +cancelOrder()
    }
    
    class Product {
        +String name
        +Number price
        +Number stock
        +updateStock()
        +getPrice()
    }
    
    User ||--o{ Order : places
    Order }o--|| Product : contains`,

            state: `stateDiagram-v2
    [*] --> Idle
    Idle --> Processing : start
    Processing --> Success : complete
    Processing --> Error : fail
    Success --> [*]
    Error --> Retry : retry
    Error --> [*] : abandon
    Retry --> Processing : attempt
    
    state Processing {
        [*] --> Validating
        Validating --> Executing
        Executing --> Finalizing
        Finalizing --> [*]
    }`,

            gantt: `gantt
    title Project Timeline
    dateFormat  YYYY-MM-DD
    section Planning
    Requirements    :done,    req, 2024-01-01, 2024-01-15
    Design         :done,    des, 2024-01-10, 2024-01-25
    section Development
    Backend        :active,  dev1, 2024-01-20, 2024-02-15
    Frontend       :         dev2, 2024-01-25, 2024-02-20
    Integration    :         int, after dev1 dev2, 10d
    section Testing
    Unit Tests     :         test1, after dev1, 5d
    System Tests   :         test2, after int, 7d
    section Deployment
    Production     :         prod, after test2, 3d`,

            pie: `pie title Project Time Distribution
    "Development" : 45
    "Testing" : 25
    "Planning" : 15
    "Documentation" : 10
    "Deployment" : 5`
        };

        // Initialize the Mermaid renderer
        const renderer = new MermaidRenderer();
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await renderer.initialize('graph-container', 'status-message', 'mermaid-input');
                console.log('üé® Mermaid renderer ready');
                
                // Auto-render the example after a short delay
                setTimeout(() => {
                    document.getElementById('render-btn').click();
                }, 1000);
                
            } catch (error) {
                console.error('Failed to initialize renderer:', error);
                document.getElementById('status-message').innerHTML = 
                    '<div class="alert alert-danger">Failed to initialize Mermaid renderer: ' + error.message + '</div>';
                document.getElementById('status-message').style.display = 'block';
            }
        });

        // Event handlers
        document.getElementById('render-btn').addEventListener('click', async () => {
            const mermaidInput = document.getElementById('mermaid-input');
            if (mermaidInput.value.trim()) {
                await renderer.renderGraph(mermaidInput.value);
            } else {
                renderer.showStatus('‚ùå Please enter Mermaid code', 'error');
            }
        });

        document.getElementById('clear-btn').addEventListener('click', () => {
            document.getElementById('mermaid-input').value = '';
            document.getElementById('graph-container').innerHTML = '';
            document.getElementById('status-message').style.display = 'none';
        });

        // Example buttons
        document.querySelectorAll('[data-example]').forEach(button => {
            button.addEventListener('click', () => {
                const exampleType = button.getAttribute('data-example');
                if (examples[exampleType]) {
                    document.getElementById('mermaid-input').value = examples[exampleType];
                    // Auto-render the example
                    setTimeout(() => {
                        document.getElementById('render-btn').click();
                    }, 200);
                }
            });
        });

        // Add keyboard shortcut (Ctrl+Enter to render)
        document.getElementById('mermaid-input').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('render-btn').click();
            }
        });

    </script>
</body>
</html>
